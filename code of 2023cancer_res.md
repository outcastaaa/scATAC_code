# cancer_res2023 
# Integrative Single-Cell Analysis Reveals Transcriptionaland Epigenetic Regulatory Features of Clear Cell Renal Cell Carcinoma

 
# 复现cancer_res2023中图片  
# [文章](https://pubmed.ncbi.nlm.nih.gov/36607615/)
# 数据：[GSE207493](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE207493) 因为该文章数据为bam文件，接下来使用nature immu的数据

# 


* 综述： 透明细胞肾细胞癌（ccRCC）是一种具有潜在高水平肿瘤异质性和遗传易感性的疾病。尽管许多研究对ccRCC进行了全面的分子表征，但DNA调控机制仍然未知，特别是在单细胞水平上。对19个ccRCC样品进行了单细胞RNA测序（scRNA-seq）和使用测序的转座酶可接近染色质的单细胞测定（scATAC-seq）。共捕获了102，723个高质量单细胞转录组信息，61，693个高质量细胞核和190，916个独特峰。我们使用全外显子组测序来了解个体之间的异质性，在体外验证长链非编码RNA（lncRNA）的功能，并通过蛋白质质谱鉴定蛋白质相互作用。构建了ccRCC的单细胞转录组和染色质可及性图谱。我们在ccRCC中发现了不同肿瘤细胞亚型的基因表达特征，并预测了它们对靶向和常规药物的敏感性。有趣的是，我们发现两种lncRNA（RP11-661C8.2和CTB-164N12.1）促进了ccRCC的侵袭和迁移，并通过体外实验进行了验证。综上所述，本研究证明了ccRCC的综合基因表达和DNA调控信息，发现并验证了促进肿瘤细胞侵袭和迁移的lncRNA，将为ccRCC的治疗提供新的见解。  


* 测序：DNA libraries were sequenced by NovaSeq 6000 (Illumina). Consistent with previous studies, we followed the 250 paired-end sequencing scheme: 50 bp read 1N, 8 bp i7 index, 16 bp i5 index, and 50 bp read 2N.  


## 软件下载
```bash
cd /mnt/d/biosoft
curl -o cellranger-atac-2.1.0.tar.gz "https://cf.10xgenomics.com/releases/cell-atac/cellranger-atac-2.1.0.tar.gz?Expires=1680819642&Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiaHR0cHM6Ly9jZi4xMHhnZW5vbWljcy5jb20vcmVsZWFzZXMvY2VsbC1hdGFjL2NlbGxyYW5nZXItYXRhYy0yLjEuMC50YXIuZ3oiLCJDb25kaXRpb24iOnsiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE2ODA4MTk2NDJ9fX1dfQ__&Signature=aVphthCFKlwHmOnTy1AB9Itk6pMya5bFMXqfbkFX7cwalMW9fEkOXdwA3eLyEdg2qgk~mkvjHpondK-RxPsCeAZ~u-8EFTazI3EebAu2uttycmkA-VHceAae37Bbpi9h~eGUb-qhrWvQQkEOzv6q2qlOs94hfQZhY-d~tVwBfeef0ujcQRWG6-Pc90YKbLdhABM3BdXJAZGP14RvZd8XZEyt4byRuXWYyVgIuQAbXzyuSRWJKEfBXoeX3uGBgwXjF3Ha~zacuQNKjBfB4l2ttNisfVVgTVzgBdrkQ8ZXtovnHtktU~rdMcwaGB8yTM8DmGYud0DKhmVD8uU4Hr7pfQ__&Key-Pair-Id=APKAI7S6A5RYOXBWRPDA"
tar -xzvf cellranger-atac-2.1.0.tar.gz
rm cellranger-atac-2.1.0.tar.gz
vim ~/.bashrc
export PATH=/mnt/d/biosoft/cellranger-atac-2.1.0:$PATH
source ~/.bashrc

cellranger-atac sitecheck > sitecheck.txt
cellranger-atac upload xuruizhi30454X@163.com sitecheck.txt
cellranger-atac testrun
```

## 前处理 
[参考  CellRanger ATAC](https://support.10xgenomics.com/single-cell-atac/software/pipelines/latest/what-is-cell-ranger-atac)      

做前处理前，一定先确定好样本测序情况+重复情况，[详细参照](https://support.10xgenomics.com/single-cell-atac/software/pipelines/latest/what-is-cell-ranger-atac)。  

For example, if your experimental design involves `two samples`, you will have to run cellranger-atac count two times - once for each sample. Then you can aggregate them with a single instance of cellranger-atac aggr, as described in [Multi-Library Aggregation](https://support.10xgenomics.com/single-cell-atac/software/pipelines/latest/using/aggr).  


1. bcl2fastq  

* 若已经获得了fastq文件，直接进行下一步即可  

* Preliminary sequencing files (.bcl) were converted to FASTQ files by CellRanger ATAC (version 1.2.0, https://support.10xgenomics.com/single-cell-atac/software/pipelines/
latest/ what-is-cell-ranger-atac) with the `cellranger-atac mkfastq` function.   

* cellranger-atac mkfastq demultiplexes raw base call (BCL) files generated by Illumina® sequencers into FASTQ files. It is a wrapper around bcl2fastq from Illumina®, with additional useful features that are specific to 10x Genomics libraries and a simplified sample sheet format.  

* Note that the term library and GEM well are treated as equivalent.  

```bash
$ cellranger-atac mkfastq --id=tiny-bcl \
                     --run=/path/to/tiny_bcl \
                     --samplesheet=cellranger-atac-tiny-bcl-samplesheet-1.0.0.csv
```
2. 下载测序数据  

```bash
# sequence

echo "<=== downloading sequence ===>"
prefetch SRR19987211 SRR19987212 SRR19987213 SRR19987214 #212+214是ATAC-seq
cd ~/data/sra
ls -lh

echo "<=== sra2fz ===>"
# paired
mkdir -p /mnt/d/scATAC/cancer_res2023/sequence
cd ~/data/sra
ls *.sra | while read id
do
  echo $id 
  fastq-dump --split-3 --gzip ${id} -O /mnt/d/scATAC/cancer_res2023/sequence/
  rm *.sra
done
# 将ATAC和RNA分开
mkdir -p /mnt/d/scATAC/cancer_res2023/sequence/ATAC

# 解压和以前不一样，在超算跑
# ATAC
cd ~/data/sra
cp SRR19987212.sra /mnt/d/scATAC/cancer_res2023/sequence/ATAC
cp SRR19987214.sra /mnt/d/scATAC/cancer_res2023/sequence/ATAC
fastq-dump --gzip SRR19987212.sra -O /mnt/d/scATAC/cancer_res2023/sequence/ATAC --split-files


# RNA
mkdir -p /mnt/d/scATAC/cancer_res2023/sequence/RNA
fastq-dump --split-3 --gzip SRR19987211.sra -O /mnt/d/scATAC/cancer_res2023/sequence/RNA
fastq-dump --split-3 --gzip SRR19987213.sra -O /mnt/d/scATAC/cancer_res2023/sequence/RNA

rsync -av /mnt/d/scATAC/cancer_res2023/ \
wangq@202.119.37.251:/share/home/wangq/xuruizhi/scATAC/cancer_res2023

# 进入超算
cd ~/xuruizhi/scATAC/cancer_res2023/sequence/ATAC
bsub -q mpi -n 24 -J methy2 -o ~/xuruizhi/scATAC/cancer_res2023/sequence/ATAC \
"/share/home/wangq/bin/fastq-dump.3.0.0 -O ~/xuruizhi/scATAC/cancer_res2023/sequence/ATAC --split-files -x --include-technical SRR19987212.sra"
/share/home/wangq/bin/fasterq-dump.3.0.0 -O /mnt/d/scATAC/cancer_res2023/sequence/ATAC --split-files -x --include-technical SRR19987212.sra
```

3. 下载基因组数据
```bash
# genome 
mkdir -p /mnt/d/scATAC/cancer_res2023/genome
cd /mnt/d/scATAC/cancer_res2023/genome
curl -O https://cf.10xgenomics.com/supp/cell-atac/refdata-cellranger-arc-GRCh38-2020-A-2.0.0.tar.gz
tar -zxvf refdata-cellranger-arc-GRCh38-2020-A-2.0.0.tar.gz
rm refdata-cellranger-arc-GRCh38-2020-A-2.0.0.tar.gz
```

## 在超算跑
* 将软件及下载好的数据传输到超算
```bash
rsync -av /mnt/d/scATAC/cancer_res2023/ \
wangq@202.119.37.251:/share/home/wangq/xuruizhi/scATAC/cancer_res2023
```
* 超算计算节点配置

型号：Flex X240M5   
2 颗 Intel E5-2680v3 CPU（2.5Ghz 12 核心）   
128GB 内存   
1 块 120GB SSD 盘   
1 个千兆以太网网口   
1 个 56Gb Infiniband 网口  
